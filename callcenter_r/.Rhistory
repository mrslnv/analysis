yaxt="n", main="Call distribution by day of week")
axis(2, at = seq(4, 30, by = 1), las=2)
plot.xts(daily["2015-12-11/2016-01-20"],major.ticks="days",major.format="%d")
plot.xts(daily["2016-12-11/2017-01-20"],major.ticks="days",major.format="%d")
plot.xts(daily["2015-12-11/2016-01-20"],major.ticks="days",major.format="%d")
plot.xts(daily["2016-12-11/2017-01-20"],major.ticks="days",major.format="%d")
plot.xts(daily["2015-12-11/2016-01-20"],major.ticks="days",major.format="%d")
plot.xts(daily["2016-12-11/2017-01-20"],major.ticks="days",major.format="%d")
min(dowSum)
str(dowSum)
dacf<-acf(daily,plot=FALSE)
plot(dacf,xaxt="n",main="ACF for #calls daily")
axis(1, at = seq(0, 28, by = 1), las=2)
auto.arima(daily,D=5,max.P = 3, max.Q = 5)
model<-arima(daily,order=c(1,0,1),seasonal=list(order=c(1,0,1),period=7))
model
describe(residuals(model))
plot(residuals(model))
plot(coredata(daily)[200:300],type="l",ylab="Num. of calls per day",xlab="Series of 100 days (from 30 Jun)",main = "Real vs. predicted data(Seasonal ARIMA)")
lines(fitted(model)[200:300],col="red")
plot(coredata(daily)[400:500],type="l")
lines(fitted(model)[400:500],col="red")
plot(coredata(daily)[450:550],type="l")
lines(fitted(model)[450:550],col="red")
hist(dowl[2]$Monday["T09:00/T18:00"])
hist(dowl[2]$Monday["T09:00/T18:00"])
d<-h[which(.indexhour(h)==13 & .indexwday(h)==1)]
describe(d)
plot(coredata(d),type = "l")
spois<-rpois(577,mean(d))
qqplot(spois,coredata(d),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
abline(0,1)
hist(dow[2]$Mon["T13:00/T14:00"],11)
plot(dowAgg$Mon,xaxt="n",yaxt="n")
axis(1, at = seq(0, 24, by = 1), las=1)
axis(2, at = seq(5, 30, by = 2), las=2)
qqplot(spois,coredata(dow[2]$Mon["T13:00/T14:00"]),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
abline(0,1)
qqplot(spois,coredata(d),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
d<-h[which(.indexhour(h)==13 & .indexwday(h)==1)]
qqplot(spois,coredata(d),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
abline(0,1)
hist(dow[2]$Mon["T9:00/T18:00"],11)
plot(dowAgg$Mon,xaxt="n",yaxt="n")
qqplot(spois,coredata(dow[2]$Mon["T09:00/T18:00"]),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
abline(0,1)
qqplot(spois,coredata(dow[2]$Mon["T09:00/T18:00"]),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
qqplot(spois,coredata(dow[2]$Mon["T09:00/T18:00"]),main="QQ plot - Pois(22.75) vs. Mondays 9-18)", xlab = "",ylab = "")
abline(0,1)
qqplot(spois,coredata(d),main="QQ plot - Pois(22.75) vs. Mondays 13-14)", xlab = "",ylab = "")
abline(0,1)
rm(list=ls())
library(lubridate)
Sys.setenv(TZ='UTC')
wt <- read.csv("wtime-output-basic.csv",stringsAsFactors = FALSE)
wt <- read.csv("wtime-output-basic.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
prob<- ts[ts>120]
prob_day <- day[day>300] #15 days
day<-apply.daily(prob,mean)
plot(prob_day,type="p")
prob_day <- day[day>300] #days[wait time > 15 min]
plot(prob_day,type="p")
length(prob)
length(prob_day)
plot(ts[ts>900])
ts[ts>900]
length(ts[ts>900])
length(ts[ts>600])
plot(ts[ts>600])
plot(ts[ts>600],major.format="%b",las=2)
plot(ts[ts>600],major.format="%b %d",las=2)
plot(ts[ts>600],major.format="%b %d",las=1)
plot(ts[ts>600],major.format="%b %d",las=2)
plot(ts[ts>600],major.format="%d %b",las=2)
plot(ts[ts>600],major.format="%d %b",las=2,type="p")
plot(ts[ts>300],major.format="%d %b",las=2,type="p")
length(ts[ts>300])
wt <- read.csv("wtime-output.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
length(ts[ts>300])
plot(ts[ts>300],major.format="%d %b",las=2,type="p")
wt[wt$delay>600,]
wt[wt$delay>900,]
h<-period.apply(ts, endpoints(ts, "hours"), mean)
head(h[h>100])
plot(ts[ts>600],major.format="%d %b",las=2,type="p")
wt <- read.csv("wtime-output-basic.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
plot(ts[ts>600],major.format="%d %b",las=2,type="p")
length(ts[ts>300])
wt <- read.csv("wtime-output.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
length(ts[ts>300])
plot(ts[ts>600],major.format="%d %b",las=2,type="p")
wt <- read.csv("wtime-output-basic.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
mean(wt$delay)
plot(ts[ts>600],major.format="%d %b",las=2,type="p")
plot(ts[ts>300],major.format="%d %b",las=2,type="p")
Sys.setenv(TZ='UTC')
as.POSIXct("2015-12-14 00:02:01")
ymd_hms("2015-12-14 00:02:01")
x<-ymd_hms("2015-12-14 00:02:01")
str(x)
dump(x)
as.numeric(x)
Sys.setenv(TZ='CET')
x<-ymd_hms("2015-12-14 00:02:01")
as.numeric(x)
?ymd_hms
x<-ymd_hms("2015-12-14 00:02:01",tz="CET")
as.numeric(x)
wt <- read.csv("wtime-output-basic.csv",stringsAsFactors = FALSE)
t<-ymd_hms(wt$time)
ts <- xts(wt$delay,as.POSIXct(t))
plot(ts[ts>300],major.format="%d %b",las=2,type="p")
mean(wt$delay)
summary(wt$delay)
wt[wt$delay>5000,]
length(wt[wt$delay>5000,])
length(wt[wt$delay>5000,2])
rm(list=ls())
Sys.setenv(TZ='UTC')
library(lubridate)
library(zoo)
library(xts)
Sys.setenv(TZ='UTC')
we <- read.csv("weather-raw.csv",stringsAsFactors = FALSE)
we$date<-as.Date(we$date,"%b %d, %Y")
codes<-str_split_fixed(we$code, "-", 4)
library(stringr)
codes<-str_split_fixed(we$code, "-", 4)
we$severity<-codes[,1]
we$tornado<-substring(codes[,2],2)
we$wind<-substring(codes[,3],2)
we$hail<-substring(codes[,4],2)
as.data.frame(unlist(lapply(we$states,function(x) length(unlist(strsplit(x,","))))))
we$state_count<-as.data.frame(unlist(lapply(we$states,function(x) length(unlist(strsplit(x,","))))))[,1]
we$nj<-as.data.frame(grepl("NJ",we$states))[,1]
we$pa<-as.data.frame(grepl("PA",we$states))[,1]
we$year<-as.data.frame(format(we$date,"%Y"))[,1]
we$month<-as.data.frame(format(we$date,"%m"))[,1]
we$day<-as.data.frame(format(we$date,"%d"))[,1]
write.csv(we,"weather.csv",row.names = FALSE)
dt <- read.csv("tz.csv",stringsAsFactors = FALSE)
t<-ymd_hms(dt$timeStamp)
ts <- xts(rep.int(1,length(t)),as.POSIXct(t))
daily<-apply.daily(ts,sum)
we$calls<-as.data.frame(unlist(sapply(we$date,function(x) daily[as.character(x)])))[,1]
View(we)
we$severity<-as.data.frame(unlist(sapply(we$severity, switch, "ENH" = 4, "HIGH" = 6, "MDT" = 5,
"MRGL" = 2, "SLGT" = 3, "TSTM" = 1, USE.NAMES = F)))[,1]
View(we)
we$date<-NULL
we$code<-NULL
we$states<-NULL
View(we)
write.csv(we,"weather_calls.csv",row.names = FALSE)
rm(list=ls())
# arima hours
library(lubridate)
library(zoo)
library(xts)
library(psych)
library(forecast)
library(xtsExtra)
#ignore timezones (avoid the danger of using CET and struggle with daylight changes)
Sys.setenv(TZ='UTC')
dt <- read.csv("time.csv",stringsAsFactors = FALSE)
#Create time series to analyze call frequency (XTS objects)
t<-ymd_hms(dt$Time.of.calls)
ts <- xts(rep.int(1,length(t)),as.POSIXct(t))
h<-period.apply(ts, endpoints(ts, "hours"), sum)
head(h)
model<-arima(h,order=c(1,0,1),seasonal=list(order=c(1,0,1),period=24*7))
model
plot(residuals(model[100:200]))
plot(coredata(h)[100:200])
plot(fitted(model)[100:200])
plot(fitted(model)[100:200])
plot(coredata(h)[450:550],type="l")
plot(fitted(model)[100:200],type="l")
lines(fitted(model)[450:550],col="red")
plot(coredata(h)[450:550],type="l")
lines(fitted(model)[450:550],col="red")
lines(fitted(model)[450:550],col="red")
lines(fitted(model)[400:550],col="red")
plot(fitted(model)[450:550],col="red")
plot(fitted(model)[1:2],col="red")
plot(fitted(model)[1:20],col="red")
plot(fitted(model)[1:200],col="red")
plot(fitted(model)[24*7:200],col="red")
plot(fitted(model)[24*7-1:200],col="red")
plot(fitted(model)[100:200],col="red")
fit<-fitted(model)
str(fit)
model
describe(residuals(model))
plot(residuals(model))
plot(fitted(model))
plot(coredata(h)[450:550],type="l")
lines(fitted(model)[450:550],col="red")
plot(fitted(model))
str(model)
?fitted
?arima.xts
?Arima
?arima
predict(model,3)
predict(model,100)
plot(predict(model,100))
plot(seq(1,100),predict(model,100))
plot(seq(1,101),predict(model,100))
length(predict(model,100))
str(predict(model,100))
plot(predict(model,100)$pred)
plot(coredata(h)[1:100],type="l")
lines(coredata(h)[1:100],col="red")
plot(coredata(h)[1:100],type="l")
lines(predict(model,100)$pred,col="col()")
lines(predict(model,100)$pred,col="red")
lines(predict(model,100)$pred)
lines(predict(model,100)$pred,col="red")
plot(predict(model,100)$pred,col="red")
lines(coredata(h)[1:100])
plot(coredata(h)[1:100])
plot(coredata(h)[1:100],type="l")
plot(predict(model,100)$pred,col="red")
plot(coredata(h)[1:100],type="l")
plot(predict(model,100)$pred,col="red")
plot(coredata(h)[1:100],type="l")
lines(predict(model,100)$pred,col="red")
x<-predict(model,100)$pred
y<-coredata(h)[1:100]
cbind(x,y)
y<-h[1:100]
cbind(x,y)
y<-cbind(index(h)[1:100],h[1:100])
index(h)[1:100]
i<-index(h)[1:100]
y<-h[1:100]
y
c
x
as.POSIXct.date(12880)
as.POSIXlt(12880)
as.POSIXct(12880)
as.Date(12880)
plot(x)
hist(x)
plot(x)
lines(coredata(h)[1:100],col="red")
y
cbind(x,y[2])
cbind(x,y[,2])
str*y
str(y)
?predict
?arima.prdict
?arima.predict
?predict.arima0
predict(model)
predict(model)$pred
predict(model,100)$pred
predict(model,n.ahead = 24)
plot(predict(model,n.ahead = 24))
plot(predict(model,n.ahead = 24),type="p")
x<-plot(predict(model,n.ahead = 24))
x<-predict(model,n.ahead = 24)
plot(x~seq(1,14))
plot(cbind(seq(1,14),x))
str(x)
?lm
plot(x$pred~seq(1,14))
plot(x$pred~seq(1,24))
plot(x$pred~seq(1,24),xlim=seq(1,24))
y<-x$pred
plot(cbind(y,seq(1,24)))
plot(y
)
lines(x$pred+2*x$se)
lines(x$pred+2*x$se,col="red")
lines(x$pred-2*x$se,col="red")
plot(cbind(x$se,seq(1,24)))
plot(x$pred+2*x$se)
lines(x$pred-2*x$se,col="red")
warinngs()
warnings()
plot(x$pred-2*x$se,col="red")
?plot
plot(cbind(x$se,seq(1,24)))
up<-x$pred+2*x$se
down<-x$pred-2*x$se
up<-x$pred+2*x$se
down<-x$pred-2*x$se
plot(x$pred,ylim=c(min(down),max(up)))
lines(up,col="red")
lines(down,col="red")
x<-predict(model,n.ahead = 96)
up<-x$pred+2*x$se
down<-x$pred-2*x$se
plot(x$pred,ylim=c(min(down),max(up)))
lines(up,col="red")
lines(down,col="red")
lines(coredata(h)[1:100],col="red")
plot(coredata(h)[500:600],col="red")
plot(coredata(h)[500:600],col="red",type="l")
y<-fitted(model)[500;600]
y<-fitted(model)[500:600]
x<-coredata(h)[500:600]
plot(x,type="l",ylim=c(min(x,y)))
plot(x,type="l",ylim=c(min(x,y),max(x,y)))
min(x,y)
min(x)
min(y)
x
min(x)
min(y)
y
y<-fitted(model)
str(y)
library(forecast)
function (object, ...)
y<-fitted(model)
str(y)
y<-fitted(model,24)
y<-fitted(model,24)
y<-fitted(model,2)
y<-fitted(model,h=24)
t<-h[-100]
t<-NULL
x<-seq(10)
x[-5]
x[-5:-1]
t<-h[-100,-1]
t<-NULL
train_d<-h["2015-12-14/2015-05-20"]
test_d<-h["2017-05-20/2015-06-04"]
train_d<-h["2015-12-14/2015-05-20"]
test_d<-h["2017-05-20/2015-06-04"]
train_m<-arima(train_d,order=c(1,0,1),seasonal=list(order=c(1,0,1),period=24*7))
train_d<-h["2015-12-14 00:00:00/2015-05-20 00:00:00"]
test_d<-h["2017-05-20 00:00:00/2015-06-04 00:00:00"]
train_d<-h["2015-12-14 00:00:00/2017-05-20 00:00:00"]
train_d<-h["2015-12-14/2017-05-20"]
test_d<-h["2017-05-20 00:00:00/2015-06-04 00:00:00"]
test_d<-h["2017-05-20 00:00:00/2017-06-04 00:00:00"]
train_m<-arima(train_d,order=c(1,0,1),seasonal=list(order=c(1,0,1),period=24*7))
pred<-predict(train_m,n.ahead= 96)
t<-test_d[1:96]
up<-pred$pred+2*pred$se
down<-pred$pred-2*pred$se
plot(t,ylim=c(min(down),max(up)))
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="blue")
plot(up)
plot(t,ylim=c(min(down),max(up)))
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="blue")
View(pred$pred)
View(cbind(pred$pred,up,down)
)
pred$pred-2*pred$se
min(down)
plot(pred$pred)
plot(t,ylim=c(min(down),max(up)))
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="blue")
lines(down,col="blue")
lines(up,col="blue")
lines(down,col="green")
lines(up,col="yellow")
plot(t,ylim=c(min(down)-10,max(up)+10))
lines(pred$pred,col="red")
lines(down,col="green")
lines(up,col="yellow")
plot(t,ylim=c(min(down)-50,max(up)+50))
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="orange")
plot(t,ylim=lim)
lines(pred$pred,col="red",ylim=lim)
?lines
plot(up)
lines(pred$pred,col="red",ylim=lim)
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="orange")
plot(t,ylim=lim)
lim<-c(min(down)-50,max(up)+50)
plot(t,ylim=lim)
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="orange")
plot(t,ylim=lim)
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="orange")
dev.off()
plot(t,ylim=lim)
lines(pred$pred,col="red")
lines(down,col="blue")
lines(up,col="orange")
plot(pred$pred,ylim=lim)
lines(pred$pred,col="red")
dev.off()
down<-pred$pred-2*pred$se
str(pred$pred)
str(coredata(pred$pred))
plot(t,ylim=lim)
up<-pred$pred+2*pred$se
down<-pred$pred-2*pred$se
lim<-c(min(down),max(up))
dev.off()
plot(t,ylim=lim)
lines(coredata(pred$pred),col="red")
lines(coredata(pred$pred),col="red")
plot(index(t),coredata(pred$pred))
plot(index(t),coredata(pred$pred),type="l")
lines(index(t),coredata(up))
lines(index(t),coredata(down))
plot(t,ylim=lim)
lines(index(t),coredata(pred$pred),col="red")
lines(index(t),coredata(down),col="blue")
lines(index(t),coredata(up),col="orange")
orange"
plot(index(t),coredata(up),col="orange")
plot(index(t),coredata(up))
plot(index(t),coredata(up),type="l")
lines(index(t),coredata(up),col="orange")
plot(t,ylim=lim)
lines(index(t),coredata(up),col="orange")
lines(index(t),coredata(down),col="blue")
lines(index(t),coredata(pred$pred),col="red")
plot(t,ylim=lim)
lines(index(t),coredata(down),col="blue")
plot(index(t),coredata(up),type="l")
lines(index(t),coredata(down),col="blue")
plot(index(t),coredata(down),type="l")
lines(index(t),coredata(up),col="orange")
plot(index(t),coredata(down),type="l",ylim=lim)
lines(index(t),coredata(up),col="orange")
lines(index(t),coredata(pred$pred),col="red")
lines(t)
lines(t,col="yellow",lwd=4)
plot(diff(traind_m),24)
plot(diff(train_m),24)
plot(diff(train_m,24))
str(diff(train_m,24))
diff(train_m,24)
diff(train_m,24)
plot(diff(h),24)
library(xtsExtra)
library(xtsExtra)
plot(diff(h),24)
plot(diff(h,24))
plot(diff(h,7*24))
plot(diff(diff(h,7*24),24)
)
plot(diff(h,7*24))
plot(diff(diff(h,24),7*24))
plot(diff(diff(h,24),7))
small<-h["2016-06-14/2016-09-20"]
plot(diff(small,24))
plot(diff(small,7*24))
plot(diff(diff(small,7*24),24))
plot(diff(small,7))
plot(diff(small,7*24))
plot(diff(small,24))
plot(diff(small,7*24))
plot(diff(small,24))
plot(diff(diff(small,24),1))
plot(diff(diff(small,7*24),1))
plot(diff(diff(small,7*24),24))
plot(diff(diff(small,7*24),7*24))
lines(diff(small,7*24),col="red")
lines(diff(diff(small,7*24),7*24),col="red")
lines(diff(diff(small,7*24),7*24),col="red")
plot(diff(diff(small,7*24),7*24))
lines(diff(small,7*24),col="red")
plot(diff(small,7*24))
lines(diff(diff(small,7*24),7*24),col="red")
plot(acf(diff(small,7*24)))
acf(diff(small,7*24))
acf(small)
acf(diff(small,1))
pacf(small)
Box.test(model,lag=7*24,type="Ljung")
Box.test(coredata(model),lag=7*24,type="Ljung")
Box.test(coredata(train_m),lag=7*24,type="Ljung")
head(coredata(train_m))
Box.test(resid(train_m),lag=7*24,type="Ljung")
Box.test(coredata(train_m),lag=1,type="Ljung")
Box.test(resid(train_m),lag=1,type="Ljung")
Box.test(resid(train_m),lag=3,type="Ljung")
Box.test(resid(train_m),lag=7,type="Ljung")
Box.test(resid(train_m),lag=12,type="Ljung")
Box.test(resid(train_m),lag=17,type="Ljung")
?Box.test
Box.test(resid(train_m),lag=7*24,type="Ljung",fitdf = 2)
rm(list = ls))
rm(list = ls()))
rm(list = ls())

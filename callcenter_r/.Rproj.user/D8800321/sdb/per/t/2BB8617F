{
    "collab_server" : "",
    "contents" : "#install.packages(\"zoo\")\nrequire(\"zoo\")\n#install.packages(\"dplyr\")\nrequire(\"dplyr\")\n\n#install.packages(\"stringr\")\nrequire(\"stringr\")\n\n#install.packages(\"plot3D\")\nrequire(\"plot3D\")\n\n#read.zoo(file=\"w:\\\\Code\\\\GoodAI\\\\short.csv\", sep = \",\", header = TRUE, index = \"timeStamp\",\n#            format = \"%Y-%m-%d %H:%M:%S\", tz = \"GMT\")\n\ndt <- read.csv(\"w:\\\\Code\\\\GoodAI\\\\tz.csv\",stringsAsFactors = FALSE)\n\nt<-as.POSIXct(dt$timeStamp)\nts <- xts(rep.int(1,length(t)),as.POSIXct(t))\ndaily <- apply.daily(ts,sum)\ndescribe(daily)\nplot.xts(daily,major.ticks=\"weeks\",major.format=\"%W\")\n\nem<-dt %>%  filter(str_detect(title, 'EMS'))\ndt <- NULL\noutliers <- em[em$lng<(-75.79),]\n\n# only 3 records are outside NY/PHI region\n#View(outliers)\n\nem <- em[em$lng>(-75.79),]\n\nsummary(em$lng)\nsummary(em$lat)\n\nx_c <- cut(em$lng, 29)\ny_c <- cut(em$lat, 29)\nz <- table(x_c, y_c)\n#hist3D(z=z, border=\"black\")\nimage2D(z=z,border=\"black\")\n\nem$desc <- NULL\nem$zip <- NULL\nem$title <- NULL\nem$twp <- NULL\nem$e <- NULL\n\nSys.setenv(TZ='UTC')\n\nemt <- em\nemt$time <- strptime(em$timeStamp,format=\"%Y-%m-%d %H:%M:%S\",tz=\"UTC\")\nem$timeStamp <- NULL\n\n\n\nwrite.csv(em,\"emergency-clean.csv\")\n\nem<- NULL\n\nemt$lat <- NULL\nemt$lng <- NULL\nemt$timeStamp <- NULL\n\n#14.12 - Mon (622 before)\nlTime<-strptime(\"2015-12-14\",format=\"%Y-%m-%d\",tz=\"UTC\")\n#5.6. - Mon (467 after)\nhTime<-strptime(\"2017-06-05\",format=\"%Y-%m-%d\",tz=\"UTC\")\n#filtered time\nft <- emt[emt$time >= lTime & emt$time <= hTime,]\n\nwrite.csv(ft,\"time.csv\")\n\n#install.packages(\"tseries\")\nrequire(\"tseries\")\n#install.packages(\"xts\")\nrequire(\"xts\")\n#install.packages(\"quantmod\")\n#require(\"quantmod\")\nrequire(\"psych\")\n\n\nts <- xts(rep.int(1,length(ft)),as.POSIXct(ft,tz=\"UTC\"))\n\ndaily <- apply.daily(ts,sum)\ndescribe(daily)\nplot.xts(daily,major.ticks=\"weeks\",major.format=\"%W\")\n\nweekly <- apply.weekly(ts,sum)\ndescribe(weekly)\nplot.xts(weekly,major.ticks=\"weeks\",major.format=\"%W\")\n\nmonthly <- apply.monthly(ts,sum)\ndescribe(monthly)\nplot.xts(monthly,major.ticks=\"months\",major.format=\"%b\")\n\n#dec21ts<-ts[\"2015-12-21\"]\n#hist(dec21ts,\"hours\")\n#dec21byHour<-period.apply(dec21ts, endpoints(dec21ts, \"hours\"), sum)\n#plot(period.apply(dec21ts, endpoints(dec21ts, \"hours\"), sum))\n\n#b<-ts[\"T10:00/T21:00\"]\n#View(b)\n\nh<-period.apply(ts, endpoints(ts, \"hours\"), sum)\ndow<-split.default(h, format(index(h), \"%A\"))\n\ndowAgg <- lapply(dow,function(x) aggregate(x, format(index(x), \"%H\"), mean))  \ndowSum <- do.call(merge, dowAgg)[,c(\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\",\"Sunday\")]\n#index(dowSum) <- as.POSIXct(index(dowSum), format=\"%HH\")\nplot(dowSum, type=\"l\", nc=1, ylim=range(dowSum), main=\"Average daily calls\", las=1)\n\ndowStd <- lapply(dow,function(x) aggregate(x, format(index(x), \"%H\"), sd))  \ndowStdSum <- do.call(merge, dowStd)[,c(\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\",\"Sunday\")]\nindex(dowStdSum) <- as.POSIXct(index(dowStdSum), format=\"%HH\")\nplot(dowStdSum, type=\"l\", nc=1, ylim=range(dowStdSum), main=\"Std daily\", las=1)\nView(dowStdSum)\n\n#peek into Mon 9-10\nhist(dow[2]$Monday[\"T09:00/T10:00\"],11)\ndescribe(dow[2]$Monday[\"T09:00/T10:00\"])\n#8-11 - pretty normal dist\nhist(dow[2]$Monday[\"T08:00/T11:00\"],11)\n# poisson? mean = sd^2 --> but hist is normal => X-lambda is NORMAL\ndescribe(dow[2]$Monday[\"T11:00/T17:00\"])\nhist(dow[2]$Monday[\"T11:00/T17:00\"])\n\n#mon<-h[.indexwday(h)==1]\n#e<-endpoints(b, \"hours\")\n#c<-period.apply(ts, endpoints(ts, \"hours\"), sum)\n#plot(c)\n#hist(c)\n#summary(c)\n\ndt <- read.csv(\"q2-output.csv\",stringsAsFactors = FALSE)\n#emt$time <- strptime(em$timeStamp,format=\"%Y-%m-%d %H:%M:%S\",tz=\"UTC\")\nstr(dt)\nhist(dt$queue,13)\nl<-dt[dt$queue>1,]\nhist(l$queue,13)\nll<-dt[dt$queue>2,]\nhist(ll$queue,13)\nlll<-dt[dt$queue>3,]\ndescribe(dt$queue)\n\nl$ntime <- strptime(l$time,format=\"%Y-%m-%d %H:%M:%S\",tz=\"UTC\")\nl.xts<-xts(l$queue,as.POSIXct(l$ntime,tz=\"UTC\"))\n#l.xts<-l.xts[\"T00:00/T06:00\"]\nhh<-period.apply(l.xts, endpoints(l.xts, \"hours\"), mean)\n\ndowl<-split.default(hh, format(index(hh), \"%A\"))\n\ndowAggl <- lapply(dowl,function(x) aggregate(x, format(index(x), \"%H\"), mean))  \ndowSuml <- do.call(merge, dowAggl)[,c(\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\",\"Sunday\")]\n#index(dowSum) <- as.POSIXct(index(dowSum), format=\"%HH\")\nplot(dowSuml, type=\"l\", nc=1, ylim=range(dowSuml), main=\"Average daily calls\", las=1)\n\ndescribe(dowl[2]$Monday[\"T05:00/T06:00\"])\nhist(dowl[2]$Monday[\"T09:00/T18:00\"])\n\n\n#time series data\nlibrary(foreign)\nbjg<-read.dta(\"c:\\\\Temp\\\\air2.dta\")\nairline.ts <- ts(bjg[, 1], start=c(1949,1), freq=12)\nbjg[, 1]\nairline.ts <- ts(bjg[, 1], start=c(1949,1), freq=12)\nhead(time(airline.ts))\ntime(airline.ts)[]\n\nmyDates = seq(as.Date(\"2003-11-19\"), as.Date(\"2003-12-30\"),by=\"2 days\") \n\ndaily <- apply.daily(ts,sum)\ndescribe(daily)\nplot.xts(daily,major.ticks=\"weeks\",major.format=\"%W\")\n\n#filter using index\nx <- timeBasedSeq('2010-01-01/2010-01-02 12:00')\nx <- xts(1:length(x), x)\n# all obs. in the first 6 and last 3 minutes of the\n# 8th and 15th hours on each day\nx[.indexhour(x) %in% c(8,15) & .indexmin(x) %in% c(0:5,57:59)]\n",
    "created" : 1497865056538.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2440474427",
    "id" : "2BB8617F",
    "lastKnownWriteTime" : 1498032808,
    "last_content_update" : 1498032808135,
    "path" : "W:/Code/GoodAI/tz.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}
{
    "collab_server" : "",
    "contents" : "#library(dplyr)\n\n#library(stringr)\n\n#library(tseries)\n\n#library(tsdecomp)\n#library(tsoutliers)\n\nlibrary(zoo)\nlibrary(lubridate)\nlibrary(xts)\nlibrary(psych)\n\nlibrary(forecast)\nlibrary(xtsExtra)\n\n#ignore timezones (avoid the danger of using CET and struggle with daylight changes)\nSys.setenv(TZ='UTC')\n\n\ndt <- read.csv(\"tz.csv\",stringsAsFactors = FALSE)\n\n#Create time series to analyze call frequency (XTS objects)\nt<-ymd_hms(dt$timeStamp)\nts <- xts(rep.int(1,length(t)),as.POSIXct(t))\n\ndaily <- apply.daily(ts,sum)\ndescribe(daily)\n\nplot.xts(daily,major.ticks=\"months\",major.format=\"%b\", las=2,type=\"l\",lwd=4,\n         main=\"Daily calls (irregular peaks)\")\n\n#14.12 - Mon (1680 before = 0.6%)\nplot(daily[\"2015-12-10/2015-12-16\"])\n\nsum(daily[\"2015-12-10/2015-12-13\"])/sum(daily)\n\n#5.6. - Mon (925 after = 0.4%)\nplot(daily[\"2017-05-30/2017-06-07\"])\nsum(daily[\"2017-06-05/2017-06-10\"])/sum(daily)\n\n#analyze <14.12. 2015 (Mon) - 5.6. 2017) (Mon)\nts<-ts[\"2015-12-14/2017-06-04\"]\nwrite.csv(list(\"Time of calls\"=index(ts)),\"time.csv\",row.names = FALSE)\ndaily <- apply.daily(ts,sum)\n\n#by week days\nh<-period.apply(ts, endpoints(ts, \"hours\"), sum)\ndow<-split.default(h, format(index(h), \"%a\"))\n\ndowAgg <- lapply(dow,function(x) aggregate(x, format(index(x), \"%H\"), mean))  \ndowSum <- do.call(merge, dowAgg)[,c(\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\",\"Sun\")]\n#index(dowSum) <- as.POSIXct(index(dowSum), format=\"%HH\")\nplot(dowSum, type=\"l\", nc=1, ylim=range(dowSum), main=\"Average hourly calls\", \n     las=1,col = c(rep(\"blue\",5),rep(\"navy\",2)))\nboxplot(coredata(dowSum),ylab=\"Num. of calls per hour\",col=\"gray\",at=c(1,2,3,4,5,7,8),\n        yaxt=\"n\", main=\"Call distribution by day of week\")\naxis(2, at = seq(4, 30, by = 1), las=2)\n\n# christmas and new year\nplot.xts(daily[\"2015-12-11/2016-01-20\"],major.ticks=\"days\",major.format=\"%d\")\nplot.xts(daily[\"2016-12-11/2017-01-20\"],major.ticks=\"days\",major.format=\"%d\")\n\n\n#min stats\nmin(dowSum)\nstr(dowSum)\nstr(coredata(dowSum))\nView(coredata(dowSum))\n\n#analysis\n#acf spikes every 7 days, also alot from the previous day\ndacf<-acf(daily,plot=FALSE)\n#:-) it works for xts directly! xtsEstra! acf(ts(coredata(daily),7))\nplot(dacf,xaxt=\"n\",main=\"ACF for #calls daily\")\naxis(1, at = seq(0, 28, by = 1), las=2)\n\n#arima model\nauto.arima(daily,D=5,max.P = 3, max.Q = 5)\n#seasonal arima\nmodel<-arima(daily,order=c(1,0,1))\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(7,0,0)))\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(8,0,0)))\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(5,0,0)))\narima(daily,order=c(1,0,1),seasonal=list(order=c(7,1,0)))\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(8,1,0)))\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(14,0,0)))\narima(daily,order=c(1,0,1),seasonal=list(order=c(14,1,0)))\narima(daily,order=c(1,0,1),seasonal=list(order=c(14,1,2)))\narima(daily,order=c(1,0,1),seasonal=list(order=c(21,1,2)))\narima(daily,order=c(1,0,1),seasonal=list(order=c(7,7,7)))\n#this is a perfect fit\nmodel<-arima(daily,order=c(1,0,1),seasonal=list(order=c(1,0,1),period=7))\nmodel\ndescribe(residuals(model))\nplot(residuals(model))\n\n\n#hourly? todo\n\n\n\n#for a sub set\ndaily[200]\nplot(coredata(daily)[200:300],type=\"l\",ylab=\"Num. of calls per day\",xlab=\"Series of 100 days (from 30 Jun)\",main = \"Real vs. predicted data(Seasonal ARIMA)\")\nlines(fitted(model)[200:300],col=\"red\")\n\n#for a sub set\nplot(coredata(daily)[400:500],type=\"l\")\nlines(fitted(model)[400:500],col=\"red\")\n\n#for a sub set\nplot(coredata(daily)[450:550],type=\"l\")\nlines(fitted(model)[450:550],col=\"red\")\n\n\n#fit with Poisson\nhist(dowl[2]$Monday[\"T09:00/T18:00\"])\n\nd<-h[which(.indexhour(h)==13 & .indexwday(h)==1)]\ndescribe(d)\nplot(coredata(d),type = \"l\")\nView(d)\nspois<-rpois(577,mean(d))\nqqplot(spois,coredata(d),main=\"QQ plot - Pois(22.75) vs. Mondays 9-18)\", xlab = \"\",ylab = \"\")\nabline(0,1)\nmean(d)\n\nhist(dow[2]$Mon[\"T13:00/T14:00\"],11)\n  plot(dowAgg$Mon,xaxt=\"n\",yaxt=\"n\")\naxis(1, at = seq(0, 24, by = 1), las=1)\naxis(2, at = seq(5, 30, by = 2), las=2)\n\n#TODO!\n\n\n\n\n#looking into location data a bit\nboxplot(dt$lng)\nboxplot(dt$lat)\noutliers <- dt[dt$lng<(-80) | dt$lat<(38),]\n\nioutliers <- dt[dt$lng<(-80),]\noutliers <- dt[dt$lat<(38),]\n\nf1<-dt[dt$lng>(-80),]\nboxplot(f1$lng)\n\n\nf2<-dt[dt$lat>(38),]\nboxplot(f1$lat)\n\n\n\n",
    "created" : 1497863821267.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "695970596",
    "id" : "1B27EF07",
    "lastKnownWriteTime" : 1498494968,
    "last_content_update" : 1498494968511,
    "path" : "W:/Code/GoodAI/callcenter_r/callcenter.R",
    "project_path" : "callcenter.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}